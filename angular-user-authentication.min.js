/*! angular-session 11-09-2014 */
!function(){"use strict";angular.module("davestone.userAuthentication",[]).provider("UserAuthentication",function(){this.cookieExpiration=0,this.cookieName="_session",this.cookieSecure=!1,this.cookieDomain="",this.cookiePath="/",this.user={user:"guest"},this.path="/",this.remember=!1,this.sessionRequiredPath="/sign_in",this.noSessionRequiredPath="/",this.set=function(a,b){this[a]=b},this.$get=["$rootScope","$cookieStore","$http","$q",function(a,b,c,d){var e={};return e.config=this,e.user=e.config.user,e.store=b,e.isSignedIn=!1,e.deauthenticate=function(){this.forget(),void 0!==this.config.deauthenticate?c(this.config.deauthenticate).success(function(b,c,d,e){a.$broadcast("session:destroyed",{status:c,data:b,headers:d,config:e})}).error(function(b,c,d,e){a.$broadcast("session:error:deauthenticate",{status:c,data:b,headers:d,config:e})}):a.$broadcast("session:destroyed",{})},e.authenticate=function(b,d){c(this.config.authenticate(angular.lowercase(b),d)).success(function(a){var b={expires:e.config.cookieExpiration,secure:e.config.cookieSecure,domain:e.config.cookieDomain,path:e.config.cookiePath};e.config.remember===!1&&delete b.expires,e.store.put(e.config.cookieName,a,b),e.identify()}).error(function(b,c,d,e){a.$broadcast("session:error:authenticate",{status:c,data:b,headers:d,config:e})})},e.identify=function(){var b=d.defer();return this.isSoftSignedIn()===!1?(b.reject(),b.promise):(c(this.config.identify(this.getCookie())).success(function(c,d,f,g){e.isSignedIn=!0,e.user=c,b.resolve(),a.$broadcast("session:created",{status:d,data:c,headers:f,config:g})}).error(function(c,d,f,g){e.forget(),b.reject(),a.$broadcast("session:error:identify",{status:d,data:c,headers:f,config:g})}),b.promise)},e.forget=function(){this.user=e.config.user,this.isSignedIn=!1,this.store.put(this.config.cookieName,{},{expires:0,secure:e.config.cookieSecure,domain:e.config.cookieDomain,path:e.config.cookiePath})},e.recall=function(){Object.keys(this.getCookie()).length>0&&(this.config.remember=!0,this.identify())},e.getCookie=function(){return this.store.get(this.config.cookieName)||{}},e.isSoftSignedIn=function(){var a=this.getCookie();return Object.keys(a).length>0?!0:!1},e}]}).controller("SessionHelper",["$scope","Session",function(a,b){a.Session=b,a.remember=b.config.remember,a.signIn=function(){b.authenticate(a.login,a.password),b.config.remember=!!a.remember},a.signOut=function(){b.deauthenticate()}}]).factory("SessionRequired",["$location","Session",function(a,b){return function(){return b.identify().then(function(){},function(){b.config.path=a.path(),a.path(b.config.sessionRequiredPath)})}}]).factory("NoSessionRequired",["$location","Session",function(a,b){return function(c){return b.identify().then(function(){a.path(c||b.config.noSessionRequiredPath)},function(){})}}])}();